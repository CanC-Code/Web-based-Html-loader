<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Video Layer — AI Editor</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>Video Layer — AI Editor</h1>
  <p class="lead">Load a video, choose an edit, watch live processing, replay, then download the result.</p>
</header>

<main>
  <section class="mediaBox">
    <div class="mediaInner">
      <label style="width:100%; text-align:center;">
        <input id="videoInput" type="file" accept="video/*" style="width:100%; padding:8px; border-radius:8px;" />
      </label>

      <video id="inputVideo" playsinline controls></video>

      <canvas id="outputCanvas" aria-label="Processed output"></canvas>
    </div>
  </section>

  <section class="controls">
    <select id="modeSelect" class="aux" title="Processing mode">
      <option value="remove">Background removal</option>
      <option value="blur">Background blur</option>
    </select>

    <button id="startBtn">Start Processing</button>
    <button id="stopBtn" disabled>Stop Processing</button>
    <button id="playBtn" disabled>Replay Processed</button>
    <button id="downloadBtn" disabled>Download Video</button>
  </section>

  <div class="progressWrap">
    <div class="progress"><div id="progressFill"></div></div>
  </div>

  <div id="status">Ready.</div>
</main>

<script src="detector.js"></script>
<script>
const videoInput = document.getElementById('videoInput');
const inputVideo = document.getElementById('inputVideo');

const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const playBtn = document.getElementById('playBtn');
const downloadBtn = document.getElementById('downloadBtn');
const modeSelect = document.getElementById('modeSelect');
const progressFill = document.getElementById('progressFill');
const statusEl = document.getElementById('status');

function setStatus(msg){ statusEl.textContent = msg; }
function setProgress(p){ progressFill.style.width = `${Math.max(0,Math.min(100,p))}%`; }

// Load video
videoInput.addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;
  inputVideo.src = URL.createObjectURL(f);
  inputVideo.load();
  inputVideo.onloadeddata = () => {
    document.getElementById('outputCanvas').width = inputVideo.videoWidth;
    document.getElementById('outputCanvas').height = inputVideo.videoHeight;
    setStatus(`Loaded: ${inputVideo.videoWidth}×${inputVideo.videoHeight}`);
    setProgress(0);
    startBtn.disabled = false;
    stopBtn.disabled = true;
    playBtn.disabled = true;
    downloadBtn.disabled = true;
  };
});

// Start processing
startBtn.addEventListener('click', async ()=>{
  if(!inputVideo.src){ setStatus('Please select a video first'); return; }

  startBtn.disabled = true;
  stopBtn.disabled = false;
  playBtn.disabled = true;
  downloadBtn.disabled = true;
  modeSelect.disabled = true;

  setStatus('Initializing detector...');
  await VideoDetector.startProcessing();

  setStatus('Processing started...');
});

// Stop processing
stopBtn.addEventListener('click', ()=>{
  VideoDetector.stopProcessing();
  startBtn.disabled = false;
  stopBtn.disabled = true;
  playBtn.disabled = false;
  downloadBtn.disabled = true;
  modeSelect.disabled = false;
  setStatus('Processing stopped.');
});

// Replay processed video
playBtn.addEventListener('click', ()=>{
  VideoDetector.playProcessed();
  downloadBtn.disabled = false;
  setStatus('Playing processed video.');
});

// Download processed video
downloadBtn.addEventListener('click', ()=>{
  VideoDetector.downloadProcessed();
  setStatus('Processed video saved.');
});

// Update progress bar based on original video
inputVideo.addEventListener('timeupdate', ()=>{
  if(inputVideo.duration && inputVideo.duration>0){
    setProgress((inputVideo.currentTime/inputVideo.duration)*100);
  }
});
</script>
</body>
</html>