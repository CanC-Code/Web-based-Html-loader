<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI Video Editor — Background Removal</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>AI Video Editor — Background Removal</h1>
  <p class="lead">Load a video, select a mode, preview edits, then save the final result.</p>
</header>

<main>
  <section class="mediaBox">
    <div class="mediaInner">
      <input id="videoInput" type="file" accept="video/*">

      <video id="inputVideo" playsinline controls></video>
      <canvas id="outputCanvas" aria-label="Processed video output"></canvas>
    </div>
  </section>

  <section class="controls">
    <button id="startBtn">Start</button>
    <button id="stopBtn" disabled>Stop</button>
    <button id="playBtn" disabled>Play Processed</button>
    <button id="downloadBtn" disabled>Download</button>
    <select id="modeSelect" class="aux">
      <option value="remove">Background Removal</option>
      <option value="blur">Background Blur</option>
    </select>
  </section>

  <div class="progressWrap">
    <div class="progress"><div id="progressFill"></div></div>
  </div>

  <div id="status">Ready.</div>
</main>

<script src="detector.js"></script>
<script>
const videoInput = document.getElementById('videoInput');
const inputVideo = document.getElementById('inputVideo');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const playBtn = document.getElementById('playBtn');
const downloadBtn = document.getElementById('downloadBtn');
const modeSelect = document.getElementById('modeSelect');
const progressFill = document.getElementById('progressFill');
const statusEl = document.getElementById('status');

let processing = false;

// Video load
videoInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if(!file) return;

  inputVideo.src = URL.createObjectURL(file);
  inputVideo.load();
  inputVideo.onloadeddata = () => {
    const canvas = document.getElementById('outputCanvas');
    canvas.width = inputVideo.videoWidth;
    canvas.height = inputVideo.videoHeight;

    statusEl.textContent = `Loaded: ${inputVideo.videoWidth}×${inputVideo.videoHeight}`;
    startBtn.disabled = false;
    stopBtn.disabled = true;
    playBtn.disabled = true;
    downloadBtn.disabled = true;
  };
});

// Start processing
startBtn.addEventListener('click', async () => {
  startBtn.disabled = true;
  stopBtn.disabled = false;
  playBtn.disabled = true;
  downloadBtn.disabled = true;
  const selectedMode = modeSelect.value;

  processing = true;
  statusEl.textContent = 'Initializing AI detector...';

  await VideoDetector.startProcessing(selectedMode);
  statusEl.textContent = 'Processing...';
});

// Stop processing
stopBtn.addEventListener('click', () => {
  processing = false;
  VideoDetector.stopProcessing();
  startBtn.disabled = false;
  stopBtn.disabled = true;
  playBtn.disabled = false;
  downloadBtn.disabled = false;
  statusEl.textContent = 'Processing stopped. You can play or download.';
});

// Play processed video
playBtn.addEventListener('click', () => VideoDetector.playProcessed());

// Download processed video
downloadBtn.addEventListener('click', () => VideoDetector.downloadProcessed());

// Optional: update progress bar
inputVideo.addEventListener('timeupdate', () => {
  if(inputVideo.duration){
    const pct = Math.min(100, (inputVideo.currentTime / inputVideo.duration) * 100);
    progressFill.style.width = `${pct}%`;
  }
});

// Warn before leaving page
window.addEventListener('beforeunload', e => {
  if(processing){
    e.preventDefault();
    e.returnValue = '';
  }
});
</script>
</body>
</html>